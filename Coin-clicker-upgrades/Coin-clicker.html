<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coin-clicker</title>
    <link rel="stylesheet" href="style-Coin-clicker.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Work+Sans:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
</head>
<body>
    <div class = content>
    <header>
        <img class = logo src="Images-Coin-clicker/logo.png" alt="logo">
        <nav> 
            <a class = home href="#">Home</a>
            <a class = market href="#">Market</a>
            <a class = rating href="#">Rating</a>
            </nav>
        <div class = profile>
            <img class = avatar src="Images-Coin-clicker/avatar.png" alt="avatar">
                <div class = profile-info> 
                    <h4 class = name >Anton Shapovalov</h4>
                    <div class = coins> 
                        <img class = coin-icon src="Images-Coin-clicker/coin.png" alt="coin">
                        <h4 id="header-balance" class = coins-total >0</h4>
                    </div>
                </div>
        </div>
    </header>
    <main>
        <aside class = cubes>
            <div class = cube>
                <img class = picture-cube src = "Images-Coin-clicker/rocket.png" alt = "rocket">
                <div class = cube-info>
                    <h4 class = title-cube >Click Accelerator</h4>
                    <h4 class = subtitle-cube >speed of earning x10</h4>
                        <div class = price-cube>
                            <img class = coin-icon-cube src="Images-Coin-clicker/coin.png" alt="coin">
                            <h4 class = coins-total-cube>10</h4>
                        </div>  
                </div>
                <button class = button-cube type="button" data-id="click-accelerator" data-name="Click Accelerator" data-description="speed of earning x10" data-price="10">Buy</button>
            </div>
            <div class = cube>
                <img class = picture-cube src = "Images-Coin-clicker/factor.png" alt = "multiplier">
                <div class = cube-info>
                    <h4 class = title-cube >Coin Multiplier</h4>
                    <h4 class = subtitle-cube>ClickCoins per click x10</h4>
                        <div class = price-cube>
                            <img class = coin-icon-cube src="Images-Coin-clicker/coin.png" alt="coin">
                            <h4 class = coins-total-cube>10</h4>
                        </div>  
                </div>
                <button class = button-cube type="button" data-id="coin-multiplier" data-name="Coin Multiplier" data-description="ClickCoins per click x10" data-price="10">Buy</button>
            </div>
            <div class = cube>
                <img class = picture-cube  src = "Images-Coin-clicker/multiplier.png" alt = "factor">
                <div class = cube-info>
                    <h4 class = title-cube >Power Tap</h4>
                    <h4 class = subtitle-cube >ClickCoins per click x2</h4>
                        <div class = price-cube>
                            <img class = coin-icon-cube src="Images-Coin-clicker/coin.png" alt="coin">
                            <h4 class = coins-total-cube>10</h4>
                        </div>  
                </div>
                <button class = button-cube type="button" data-id="power-tap" data-name="Power Tap" data-description="ClickCoins per click x2" data-price="10">Buy</button>
            </div>
            <div class = cube>
                <img class = picture-cube src = "Images-Coin-clicker/present.png" alt = "present">
                <div class = cube-info>
                    <h4 class = title-cube>Golden Touch</h4>
                    <h4 class = subtitle-cube >random bonus on click</h4>
                        <div class = price-cube>
                            <img class = coin-icon-cube src="Images-Coin-clicker/coin.png" alt="coin">
                            <h4 class = coins-total-cube>10</h4>
                        </div>  
                </div>
                <button class = button-cube type="button" data-id="golden-touch" data-name="Golden Touch" data-description="random bonus on click" data-price="10">Buy</button>
            </div>
            <div class = cube>
                <img class = picture-cube src = "Images-Coin-clicker/schedule.png" alt = "schedule">
                <div class = cube-info>
                    <h4 class = title-cube  >Coin Stream</h4>
                    <h4 class = subtitle-cube>passive income x10</h4>
                        <div class = price-cube>
                            <img class = coin-icon-cube src="Images-Coin-clicker/coin.png" alt="coin">
                            <h4 class = coins-total-cube>10</h4>
                        </div>  
                </div>
                <button class = button-cube type="button" data-id="coin-stream" data-name="Coin Stream" data-description="passive income x10" data-price="10">Buy</button>
            </div>
            <div class = cube>
                <img class = picture-cube src = "Images-Coin-clicker/drone.png" alt = "drone">
                <div class = cube-info>
                    <h4 class = title-cube>Mining Drone</h4>
                    <h4 class = subtitle-cube>automated taps for 1 min</h4>
                        <div class = price-cube>
                            <img class = coin-icon-cube src="Images-Coin-clicker/coin.png" alt="coin">
                            <h4 class = coins-total-cube>10</h4>
                        </div>  
                </div>
                <button class = button-cube type="button" data-id="mining-drone" data-name="Mining Drone" data-description="automated taps for 1 min" data-price="10">Buy</button>
            </div>
        </aside>
        <div class = main-info>
        <div class = rectangles>
            <div class = first-rectangle>
                <img class = picture-rectangle src="Images-Coin-clicker/hand-with-coin.png" alt="hand-with-coin">
                <div class = info-rectangle>
                    <h3 id="first-rectangle-balance" class = title-rectangle>0</h3>
                    <h4 class = subtitle-rectangle>Total ClickCoins</h4>
                </div>
            </div>
            <div class = second-rectangle>
                <img class = picture-rectangle src="Images-Coin-clicker/coin-hand.png" alt="coin-hand">
                <div class = info-rectangle >
                    <h3 id="second-rectangle-balance" class = title-rectangle>20</h3>
                    <h4 class = subtitle-rectangle>Coins per Click</h4>
                </div>
            </div>
            <div class = third-rectangle >
                <img class = picture-rectangle src="Images-Coin-clicker/clock.png" alt="clock">
                <div class = info-rectangle>
                    <h3 id="third-rectangle-balance" class = title-rectangle>1 /sec</h3>
                    <h4 class = subtitle-rectangle>Passive Income</h4>
                </div>
        </div>
        </div>
        <div class = big-coin>
            <img id = "big-coin" class = big-coin-img src="Images-Coin-clicker/big-coin-first-frame.png" alt="big-coin">
        </div>
        </div>
    </main>
    <footer>
        <div class = footer-info>
            <a class = title-footer href = #>About game</a>
            <a class = title-footer href = #>Help center</a>
            <a class = title-footer href = #>Rules</a>
        </div>
    </footer>
    </div>
</body>
</html>
<script src="script-click-coins.js" defer></script>
<script> 
    document.addEventListener("DOMContentLoaded", function () {
    const currentUser = JSON.parse(localStorage.getItem('currentUser'));
    const nameElem = document.querySelector('.name');
    if (nameElem && currentUser && currentUser.email) {
        nameElem.textContent = currentUser.email;
    }
});
document.querySelectorAll('.button-cube').forEach(button => {
    button.addEventListener('click', function() {
        const upgradeId = this.getAttribute('data-id');
        const currentUser = JSON.parse(localStorage.getItem('currentUser'));
        if (!currentUser) {
            console.error('User not found');
            return;
        }
        fetch('http://localhost:3000/buy-upgrade', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ userId: currentUser.id, upgradeId })
        })
        .then(res => res.json())
        .then(data => {
            if (data.balance !== undefined) {
                document.getElementById('first-rectangle-balance').textContent = data.balance;
                document.getElementById('header-balance').textContent = data.balance;
            }
            if (data.coinsPerClick !== undefined) {
                document.getElementById('second-rectangle-balance').textContent = data.coinsPerClick;
            }
            if (data.passiveIncomePerSecond !== undefined) {
                document.getElementById('third-rectangle-balance').textContent = data.passiveIncomePerSecond + ' /sec';
            }
            updateUpgradeButtons(); 
        });
    });
});

function updateUpgradeButtons() {
    const currentUser = JSON.parse(localStorage.getItem('currentUser'));
    if (!currentUser) return;

    fetch('http://localhost:3000/users')
        .then(res => res.json())
        .then(users => {
            const user = users.find(u => u.id === currentUser.id);
            if (!user) return;
            document.querySelectorAll('.button-cube').forEach(button => {
                const upgradeId = button.getAttribute('data-id');
                if (user.upgrades && user.upgrades.includes(upgradeId)) {
                    button.disabled = true;
                    button.style.opacity = '0.5';
                } else {
                    button.disabled = false;
                    button.style.opacity = '1';
                }
            });
        });
}
window.addEventListener('load', updateUpgradeButtons);
</script>
